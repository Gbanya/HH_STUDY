**数据库连接池笔记（解决数据库连接性能低，资源浪费的问题，所有代码见day0715-code）**  

----------


**一、数据库连接池_概述**  
1.概念：其实就是一个容器（集合），存放【数据库连接】的容器；当系统初始化好后，容器被创建，容器中会申请一些连接对象；当用户来访问数据库时，从容器中获取连接对象，用户访问完之后，会将连接对象归还给容器  
2.优点：  
&nbsp;&nbsp;&nbsp;a.节约系统资源  
&nbsp;&nbsp;&nbsp;b.用户访问高效  

**二、数据库连接池_实现介绍**  
1.标准接口DataSource（javax.sql包下）  
&nbsp;&nbsp;&nbsp;获取连接：getConnection()  
&nbsp;&nbsp;&nbsp;归还连接：如果连接对象connection是从连接池中获取的，那么调用Connection.close()方法，则不会再关闭连接，而是归还连接  
2.一般我们不去实现它，由数据库厂商来实现  
&nbsp;&nbsp;&nbsp;a.C3P0：数据库连接池技术（比较老）  
&nbsp;&nbsp;&nbsp;b.Druid：数据库连接池技术（阿里巴巴提供，比较新）  

**三、数据库连接池_C3P0_基本使用**  
步骤：  
1.导入jar包：c3p0-0.9.5.5.jar 和 mchange-commons-java-0.2.19.jar 以及数据库驱动jar包 mysql-connector-java-5.1.49-bin.jar  
2.定义配置文件：  
&nbsp;&nbsp;&nbsp;名称：c3p0.properties 或者 c3p0-config.xml  
&nbsp;&nbsp;&nbsp;路径：直接将文件放在src目录下即可（自己去找，不需要手动再去配置文件名称和路径）  
3.创建核心对象：数据库连接池对象 ComboPooledDataSource  
4.获取连接：getConnection()  

day0715-code/src/demo/c3p0/Demo01.java  

    package demo.c3p0;
    
    import com.mchange.v2.c3p0.ComboPooledDataSource;    
    import javax.sql.DataSource;
    import java.sql.Connection;
    import java.sql.SQLException;
    
    /**
     * @program: TODO
     * @className:Demo01
     * @description:c3p0的演示
     * @author: 何文艺
     * @create: 2020/7/15 16:15
     **/
    public class Demo01 {
        public static void main(String[] args) {
            //1.创建数据库连接池对象
            DataSource ds = new ComboPooledDataSource();
            //2.获取连接对象
            try {
                for (int i = 0; i < 11; i++) {
                    Connection conn = ds.getConnection();
                    System.out.println(i + ":" + conn);
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }

**四、数据库连接池_C3P0_配置演示（见day0715-code/src/c3p0-config.xml文件）**  

**五、数据库连接池_Druid_基本使用**  
步骤：  
1.导入jar包 druid-1.0.9.jar  
2.定义配置文件:是properties形式；可以叫任意名称，可以放在任意目录下（不会自动加载，手动指定文件的名称和路径）  
3.加载配置文件 Properties  
4.获取数据库连接池对象：通过工厂类来获取 DruidDataSourceFactory  
5.获取连接：getConnection()  

day0715-code/src/demo/druid/Demo01.java

    package demo.druid;
    
    import com.alibaba.druid.pool.DruidDataSource;
    import com.alibaba.druid.pool.DruidDataSourceFactory;
    
    import javax.sql.DataSource;
    import java.io.IOException;
    import java.io.InputStream;
    import java.sql.Connection;
    import java.util.Properties;
    
    /**
     * @program: TODO
     * @className:Demo01
     * @description:druid演示
     * @author: 何文艺
     * @create: 2020/7/16 9:40
     **/
    public class Demo01 {
        public static void main(String[] args) throws Exception {
            //1.导入jar包
            //2.定义配置文件
            //3.加载配置文件
            Properties pro = new Properties();
            InputStream is = Demo01.class.getClassLoader().getResourceAsStream("druid.properties");
            pro.load(is);
            //4.获取连接池对象
            DataSource ds = DruidDataSourceFactory.createDataSource(pro);
            //5.获取连接
            Connection conn = ds.getConnection();
            System.out.println(conn);
        }
    }

**六、数据库连接池_Druid_工具类**  
1.定义一个类 JDBCUtils  
2.提供静态代码块加载配置文件并初始化连接池对象  
3.提供方法  
&nbsp;&nbsp;&nbsp;a.获取连接方法：通过数据库连接池来获取连接  
&nbsp;&nbsp;&nbsp;b.释放资源  
&nbsp;&nbsp;&nbsp;c.获取连接池的方法  

**七、数据库连接池_Druid_工具类测试**  
Druid_工具类day0715-code/src/utils/JDBCUtils.java  

    package utils;
    
    import com.alibaba.druid.pool.DruidDataSourceFactory;
    
    import javax.sql.DataSource;
    import java.io.IOException;
    import java.sql.Connection;
    import java.sql.ResultSet;
    import java.sql.SQLException;
    import java.sql.Statement;
    import java.util.Properties;
    
    /**
     * @program: TODO
     * @className:JDBCUtils
     * @description:连接池工具类
     * @author: 何文艺
     * @create: 2020/7/16 9:53
     **/
    public class JDBCUtils {
        //1.定义一个成员变量 DataSource
        private static DataSource ds;
    
        static {
            try {
                //1.加载配置文件
                Properties pro = new Properties();
                pro.load(JDBCUtils.class.getClassLoader().getResourceAsStream("druid.properties"));
                //2.获取DataSource
                ds = DruidDataSourceFactory.createDataSource(pro);
            } catch (IOException e) {
                e.printStackTrace();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    
        //获取连接
        public static Connection getConnection() throws SQLException {
            return ds.getConnection();
        }
    
        //释放连接
        public static void close(ResultSet rs,Statement stmt, Connection conn) {
            try {
                if (rs != null) {
                    rs.close();
                }
                if (stmt != null) {
                    stmt.close();
                }
                if (conn != null) {
                    conn.close();
                }
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        public static void close(Statement stmt, Connection conn) {
            close(null, stmt, conn);
        }
    
        //获取连接池
        public static DataSource getDataSource() {
            return ds;
        }
    }

day0715-code/src/demo/druid/Demo01.java  

    package demo.druid;
    
    import utils.JDBCUtils;
    
    import java.sql.Connection;
    import java.sql.PreparedStatement;
    import java.sql.SQLException;
    import java.sql.Statement;
    
    /**
     * @program: TODO
     * @className:Demo02
     * @description:druid工具类测试
     * @author: 何文艺
     * creat: 2020/7/16 10:06
     **/
    public class Demo02 {
        public static void main(String[] args) {
            Connection conn = null;
            PreparedStatement pstmt = null;
            try {
                //1.获取数据库连接
                conn = JDBCUtils.getConnection();
                //2.创建sql语句
                String sql = "insert into account values(5,?,?)";
                //获取执行sql语句的对象
                pstmt = conn.prepareStatement(sql);
                pstmt.setString(1,"大海");
                pstmt.setDouble(2,3600);
                //执行sql语句
                int count = pstmt.executeUpdate();
            } catch (SQLException e) {
                e.printStackTrace();
            } finally {
                JDBCUtils.close(pstmt,conn);
            }
        }
    }