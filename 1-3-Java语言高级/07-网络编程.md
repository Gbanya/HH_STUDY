# 网络编程

- 网络编程：在一定的协议下，实现两台计算机的通信的程序。

## 网络通信概述

- 软件结构：
  - **C/S结构**：Client/Server结构，是指客户端和服务器结构。例如：QQ、迅雷等软件。
  - **B/S结构**：Browser/Server结构，是指浏览器和服务器结构。例如：谷歌、火狐等。

### 网络通信协议

- 网络通信协议：在计算机网络中，这些连接和通信规则被称之为网络通信协议，对数据的传输格式、传输速率、传输步骤等做了统一规定，通信双方必须同时遵守才能完成数据交换。
- **TCP/IP协议**：传输控制协议/因特网互联协议，是Internet最基本、最广泛的协议。它定义了计算机如何连入因特网，以及数据如何在它们之间传输的标准。

### 协议分类

- UDP：用户数据报协议（User Datagram Protocol）。UDP是无连接通信协议。

  特点：

  消耗资源小，通信效率高，传输过程中可能会发送数据丢失。

  数据被限制在64kb以内，超出这个范围就不能发送了。

- TCP：传输控制协议（Transmission Control Protocol）。TCP是面向连接的通信协议，在数据传输前，发送端和接收端之间要建立连接。

  特点：

  通过三次握手，建立连接，保证了传输数据的安全。

### 网络编程三要素

1. **协议**

   - 协议：计算机网络通信必须遵守的规则。

2. **IP地址**

   - IP地址：指互联网协议地址（Internet Protocol Address）。IP地址用来给一个网络中的计算机设备做唯一的编号。
   - IP地址分类
     - IPv4：是一个32位的二进制，通常被分为4个字节，表示成`a.b.c.d`的形式。
     - IPv6：解决了网络地址资源数量不够用的问题。

   - 常用命令

     - 查看本机IP地址

       `ipconfig`

     - 检查网络是否连通

       `ping 空格 IP地址`

     - 特殊的IP地址

       本机IP地址：`127.0.0.1`、`localhost`

3. **端口号**

   -   端口号是由两个字节组成，取值范围在0~65535之间。

     【注意】1024之前的端口号我们不能使用，已经被系统分配给已知的网络软件了。网络软件的端口号不能重复使用。

   - 常用的端口号

     1. 80端口 网络端口	www.baidu.com:80
     2. 数据库   mysql：3306    oracle:1521
     3. Tomcat服务器：8080

##  TCP通信程序

- TCP通信能实现两台计算机之间的数据交互，通信的两端，严格区分为客户端（Client）和服务器（Server）。
- 两端通信时步骤：
1. 服务器端程序，需要事先启动，等待客户端的连接。
  2. 客户端主动连接服务器端，连接成功才能通信。服务器端不可以主动连接客户端。

- 客户端和服务端连接就会建立一个逻辑连接，这个**连接中就包含一个IO对象**；客户端和服务器通过IO对象进行通信，通信数据不仅仅是字符，因此**IO对象是字节流对象**。
- 套接字：包含了IP地址和端口号的网络单位。

- **在Java中，提供了两个类用于实现TCP通信程序**：
  1. 客户端：`java.net.Socket`类表示。创建`Socket`对象，向服务端发出连接请求，服务端响应请求，两者建立连接开始通信。
  2. 服务端：`java.net.ServerSocket`类表示。创建`ServerSocket`对象，相当于开启一个服务，并等待客户端的连接。

- ==**TCP通信客户端的实现步骤**：==

  1. 创建一个客户端对象`Socket`，构造方法绑定服务器的IP地址和端口号。
  2. 使用Socket对象中的方法`getOutputStream()`获取网络字节输出流`OutputStream`对象。
  3. 使用网络字节输出流`OutputStream()`对象中的方法`write`，给服务器发送数据。
  4. 使用Socket对象中的方法`getInputStream()`获取网络字节输入流`InputStream`对象。
  5. 使用网络字节输入流`InputStream`对象中的方法`read`，读取服务器回写的数据。
  6. 释放资源（`Socket`）

  【注意】

  1. 客户端和服务端进行交互，必须使用Socket中提供的网络流，不能使用自己创建的流对象。
  2. 当我们创建客户端对象Socket时，就会取请求服务器和服务器经过3次握手建立连接通路。

- ==**TCP通信的服务端的实现步骤**：==
  1. 创建服务器`ServerSocket`对象和系统要指定的端口号。
  2. 使用`ServerSocket`对象中的方法`accept`，获取到请求的客户端对象`Socket`。
  3. 使用Socket对象中的方法`getInputStream()`获取网络字节输入流`InputStream`对象。
  4. 使用网络字节输入流`InputStream`对象中的方法`read`，读取客户端发送的数据。
  5. 使用Socket对象中的方法`getOutputStream()`获取网络字节输出流`OutputStream`对象。
  6. 使用网络字节输出流`OutputStream()`对象中的方法`write`，给客户端回写数据。
  7. 释放资源（`Socket`、`ServerSocket`）。

- 【例】TCP通信的文件上传

  - 原理：客户端读取本地的文件，把文件上传到服务器，服务器再把上传的文件保存到服务器的硬盘上。
  - 步骤：
    1. 客户端使用本地的字节输入流，读取要上传的文件。
    2. 客户端使用网络字节输出流，把读取到的文件上传到服务器。
    3. 服务器使用网络字节输入流，读取客户端上传的文件。
    4. 服务器使用本地字节输出流，把读取到的文件写入服务器的硬盘。
    5. 服务器使用网络字节输出流，给客户端回写一个“上传成功”。
    6. 客户端使用网络字节输入流，读取服务器回写的数据。
    7. 释放资源。

  - 【注意】
    1. 客户端和服务器和本地硬盘进行读写时，需要使用自己创建的字节流对象（本地流）。
    2. 客户端和服务器之间进行读写，必须使用`Socket`中提供的字节流对象（网络流）。



