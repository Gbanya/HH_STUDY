## Zookeeper选举机制

#### 选举机制

1. 第一阶段：数据恢复阶段，每台Zookeeper服务器在启动的时候，都会从本地的数据目录中找到自己所拥有的最大事务id。

2. 第二阶段：选举阶段，每一个Zookeeper的服务器都会推荐自己当leader并且提交选举协议：
   * 自己所拥有的最大事务id  -Zxid
   * 自己的选举id  -myid
   * 逻辑时钟值，作用是确保每一台Zookeeper服务器都会处在同一轮选举中

3. 节点状态
   * Looking -- 选举状态
   * follower  -- 追随者
   * leader -- 领导者
   * observer -- 观察者


#### PK原则

1. 在选举的时候会先比较两个节点的最大事务id即Zxid。Zxid越大，则说明事务越新。Zxid较大的会胜出
2. 如果Zxid一致，则比较选举id，选举id较大的胜出。
3. 满足过半性：即超过一半的节点才能成为leader

#### 过半性

1. 过半选举：即只有一个节点胜过一半的节点之后才能成为leader
2. 过半服务：即只有Zookeeper集群中超过一半的节点存活才能对外提供服务
3. 过半操作：即只有Zookeeper集群中超过一半的节点同意才会提交请求